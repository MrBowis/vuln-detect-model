
<!DOCTYPE html>
<html>
<head>
    <title>Reporte de Auditor√≠a IA - SHAP</title>
    <style>
        body { font-family: sans-serif; padding: 20px; color: #333; }
        h1 { color: #2c3e50; }
        table { width: 100%; border-collapse: collapse; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        th { background-color: #34495e; color: white; padding: 12px; text-align: left; }
        .badge-danger { background-color: #e74c3c; color: white; padding: 4px 8px; border-radius: 4px; font-weight: bold; }
        .badge-success { background-color: #27ae60; color: white; padding: 4px 8px; border-radius: 4px; font-weight: bold; }
        .token-danger { color: #c0392b; font-weight: bold; background: #fadbd8; padding: 0 4px; border-radius: 3px; }
        .token-safe { color: #1e8449; font-weight: bold; background: #d5f5e3; padding: 0 4px; border-radius: 3px; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>
    <h1>üõ°Ô∏è Reporte de Vulnerabilidades (IA + SHAP)</h1>
    <p>Este reporte detalla por qu√© el modelo clasific√≥ cada fragmento. Los valores entre par√©ntesis indican el <strong>impacto SHAP</strong> (cuanto m√°s alto, m√°s contribuy√≥ a la clasificaci√≥n).</p>
    <table>
        <thead>
            <tr>
                <th width="10%">Lenguaje</th>
                <th width="40%">Snippet de C√≥digo</th>
                <th width="15%">Estado</th>
                <th width="35%">An√°lisis de Tokens (IA Explicable)</th>
            </tr>
        </thead>
        <tbody>
            
    <tr style="background-color: #ffe6e6; border-bottom: 1px solid #ddd;">
        <td style="padding: 10px;"><strong>Python</strong></td>
        <td style="padding: 10px;"><pre style="margin:0; font-size: 0.9em;">cursor.execute(f'SELECT * FROM t WHERE id={x}')</pre></td>
        <td style="padding: 10px; text-align: center;"><span class='badge-danger'>PELIGROSO üî¥</span><br><small>89.1% Riesgo</small></td>
        <td style="padding: 10px;">
            <strong>Factores de Riesgo:</strong><br><span class='token-danger'>execute ( (1.48)</span>, <span class='token-danger'>) (0.30)</span>, <span class='token-danger'>where (0.19)</span>, <span class='token-danger'>execute (0.14)</span>, <span class='token-danger'>f (0.14)</span><br>
            <hr style="margin: 5px 0; border: 0; border-top: 1px dashed #ccc;">
            <small>Factores de Seguridad: <span class='token-safe'>select (-0.00)</span>, <span class='token-safe'>* (-0.00)</span>, <span class='token-safe'>t (-0.02)</span></small>
        </td>
    </tr>
    
    <tr style="background-color: #e6fffa; border-bottom: 1px solid #ddd;">
        <td style="padding: 10px;"><strong>Python</strong></td>
        <td style="padding: 10px;"><pre style="margin:0; font-size: 0.9em;">cursor.execute('SELECT * FROM t WHERE id=%s', (x,))</pre></td>
        <td style="padding: 10px; text-align: center;"><span class='badge-success'>SEGURO üü¢</span><br><small>45.5% Riesgo</small></td>
        <td style="padding: 10px;">
            <strong>Factores de Riesgo:</strong><br><span class='token-danger'>execute ( (1.15)</span>, <span class='token-danger'>where (0.19)</span>, <span class='token-danger'>execute (0.12)</span>, <span class='token-danger'>. (0.04)</span>, <span class='token-danger'>* from (0.02)</span><br>
            <hr style="margin: 5px 0; border: 0; border-top: 1px dashed #ccc;">
            <small>Factores de Seguridad: <span class='token-safe'>( x (-0.00)</span>, <span class='token-safe'>select (-0.00)</span>, <span class='token-safe'>* (-0.00)</span></small>
        </td>
    </tr>
    
    <tr style="background-color: #ffe6e6; border-bottom: 1px solid #ddd;">
        <td style="padding: 10px;"><strong>Java</strong></td>
        <td style="padding: 10px;"><pre style="margin:0; font-size: 0.9em;">Runtime.getRuntime().exec(userInput);</pre></td>
        <td style="padding: 10px; text-align: center;"><span class='badge-danger'>PELIGROSO üî¥</span><br><small>98.0% Riesgo</small></td>
        <td style="padding: 10px;">
            <strong>Factores de Riesgo:</strong><br><span class='token-danger'>userinput ); (3.04)</span>, <span class='token-danger'>exec (0.92)</span>, <span class='token-danger'>(). (0.69)</span>, <span class='token-danger'>exec ( (0.39)</span>, <span class='token-danger'>); (0.05)</span><br>
            <hr style="margin: 5px 0; border: 0; border-top: 1px dashed #ccc;">
            <small>Factores de Seguridad: <span class='token-safe'>. (-0.05)</span>, <span class='token-safe'>( userinput (-0.79)</span></small>
        </td>
    </tr>
    
    <tr style="background-color: #e6fffa; border-bottom: 1px solid #ddd;">
        <td style="padding: 10px;"><strong>JavaScript</strong></td>
        <td style="padding: 10px;"><pre style="margin:0; font-size: 0.9em;">document.getElementById('app').innerHTML = userInput;</pre></td>
        <td style="padding: 10px; text-align: center;"><span class='badge-success'>SEGURO üü¢</span><br><small>10.7% Riesgo</small></td>
        <td style="padding: 10px;">
            <strong>Factores de Riesgo:</strong><br><span class='token-danger'>innerhtml (0.53)</span>, <span class='token-danger'>userinput (0.10)</span>, <span class='token-danger'>document (0.07)</span>, <span class='token-danger'>document . (0.03)</span>, <span class='token-danger'>( (0.01)</span><br>
            <hr style="margin: 5px 0; border: 0; border-top: 1px dashed #ccc;">
            <small>Factores de Seguridad: <span class='token-safe'>; (-0.02)</span>, <span class='token-safe'>= (-0.04)</span>, <span class='token-safe'>. (-0.08)</span></small>
        </td>
    </tr>
    
    <tr style="background-color: #ffe6e6; border-bottom: 1px solid #ddd;">
        <td style="padding: 10px;"><strong>C#</strong></td>
        <td style="padding: 10px;"><pre style="margin:0; font-size: 0.9em;">var cmd = new SqlCommand("SELECT * FROM T WHERE N='" + n + "'", c);</pre></td>
        <td style="padding: 10px; text-align: center;"><span class='badge-danger'>PELIGROSO üî¥</span><br><small>97.0% Riesgo</small></td>
        <td style="padding: 10px;">
            <strong>Factores de Riesgo:</strong><br><span class='token-danger'>+ (3.60)</span>, <span class='token-danger'>where (0.15)</span>, <span class='token-danger'>); (0.06)</span>, <span class='token-danger'>( (0.05)</span>, <span class='token-danger'>* from (0.01)</span><br>
            <hr style="margin: 5px 0; border: 0; border-top: 1px dashed #ccc;">
            <small>Factores de Seguridad: <span class='token-safe'>c (-0.00)</span>, <span class='token-safe'>select (-0.00)</span>, <span class='token-safe'>var (-0.00)</span></small>
        </td>
    </tr>
    
    <tr style="background-color: #e6fffa; border-bottom: 1px solid #ddd;">
        <td style="padding: 10px;"><strong>C++</strong></td>
        <td style="padding: 10px;"><pre style="margin:0; font-size: 0.9em;">char b[10]; strcpy(b, input);</pre></td>
        <td style="padding: 10px; text-align: center;"><span class='badge-success'>SEGURO üü¢</span><br><small>16.2% Riesgo</small></td>
        <td style="padding: 10px;">
            <strong>Factores de Riesgo:</strong><br><span class='token-danger'>( (0.07)</span>, <span class='token-danger'>); (0.07)</span>, <span class='token-danger'>10 (0.00)</span>, <span class='token-danger'>char (0.00)</span><br>
            <hr style="margin: 5px 0; border: 0; border-top: 1px dashed #ccc;">
            <small>Factores de Seguridad: <span class='token-safe'>b (-0.00)</span>, <span class='token-safe'>[ (-0.01)</span>, <span class='token-safe'>]; (-0.11)</span></small>
        </td>
    </tr>
    
    <tr style="background-color: #ffe6e6; border-bottom: 1px solid #ddd;">
        <td style="padding: 10px;"><strong>JavaScript</strong></td>
        <td style="padding: 10px;"><pre style="margin:0; font-size: 0.9em;">var ejecucion = eval(input_string);</pre></td>
        <td style="padding: 10px; text-align: center;"><span class='badge-danger'>PELIGROSO üî¥</span><br><small>94.8% Riesgo</small></td>
        <td style="padding: 10px;">
            <strong>Factores de Riesgo:</strong><br><span class='token-danger'>eval ( (3.32)</span>, <span class='token-danger'>eval (0.39)</span>, <span class='token-danger'>var (0.19)</span>, <span class='token-danger'>( (0.03)</span>, <span class='token-danger'>); (0.03)</span><br>
            <hr style="margin: 5px 0; border: 0; border-top: 1px dashed #ccc;">
            <small>Factores de Seguridad: <span class='token-safe'>input_string (-0.80)</span></small>
        </td>
    </tr>
    
    <tr style="background-color: #ffe6e6; border-bottom: 1px solid #ddd;">
        <td style="padding: 10px;"><strong>JavaScript</strong></td>
        <td style="padding: 10px;"><pre style="margin:0; font-size: 0.9em;">document.write('&lt;h1&gt;Bienvenido: ' + input_string + '&lt;/h1&gt;');</pre></td>
        <td style="padding: 10px; text-align: center;"><span class='badge-danger'>PELIGROSO üî¥</span><br><small>98.4% Riesgo</small></td>
        <td style="padding: 10px;">
            <strong>Factores de Riesgo:</strong><br><span class='token-danger'>+ (3.17)</span>, <span class='token-danger'>. write (0.21)</span>, <span class='token-danger'>< (0.09)</span>, <span class='token-danger'>( (0.08)</span>, <span class='token-danger'>. (0.07)</span><br>
            <hr style="margin: 5px 0; border: 0; border-top: 1px dashed #ccc;">
            <small>Factores de Seguridad: <span class='token-safe'>write (-0.00)</span></small>
        </td>
    </tr>
    
    <tr style="background-color: #ffe6e6; border-bottom: 1px solid #ddd;">
        <td style="padding: 10px;"><strong>JavaScript</strong></td>
        <td style="padding: 10px;"><pre style="margin:0; font-size: 0.9em;">var elemento = document.getElementById('perfil');elemento.innerHTML = input_string;</pre></td>
        <td style="padding: 10px; text-align: center;"><span class='badge-danger'>PELIGROSO üî¥</span><br><small>97.1% Riesgo</small></td>
        <td style="padding: 10px;">
            <strong>Factores de Riesgo:</strong><br><span class='token-danger'>. innerhtml (3.16)</span>, <span class='token-danger'>innerhtml (0.63)</span>, <span class='token-danger'>( (0.22)</span>, <span class='token-danger'>document (0.17)</span>, <span class='token-danger'>document . (0.05)</span><br>
            <hr style="margin: 5px 0; border: 0; border-top: 1px dashed #ccc;">
            <small>Factores de Seguridad: <span class='token-safe'>var (-0.00)</span>, <span class='token-safe'>. (-0.02)</span>, <span class='token-safe'>); (-0.03)</span></small>
        </td>
    </tr>
    
    <tr style="background-color: #e6fffa; border-bottom: 1px solid #ddd;">
        <td style="padding: 10px;"><strong>JavaScript</strong></td>
        <td style="padding: 10px;"><pre style="margin:0; font-size: 0.9em;">if (input_string == 0) { console.log('El input es cero o falso'); } return ejecucion;</pre></td>
        <td style="padding: 10px; text-align: center;"><span class='badge-success'>SEGURO üü¢</span><br><small>48.1% Riesgo</small></td>
        <td style="padding: 10px;">
            <strong>Factores de Riesgo:</strong><br><span class='token-danger'>== (0.18)</span>, <span class='token-danger'>) (0.18)</span>, <span class='token-danger'>); (0.09)</span>, <span class='token-danger'>. (0.05)</span>, <span class='token-danger'>if ( (0.04)</span><br>
            <hr style="margin: 5px 0; border: 0; border-top: 1px dashed #ccc;">
            <small>Factores de Seguridad: <span class='token-safe'>== 0 (-0.00)</span>, <span class='token-safe'>{ (-0.00)</span>, <span class='token-safe'>( (-0.01)</span></small>
        </td>
    </tr>
    
    <tr style="background-color: #ffe6e6; border-bottom: 1px solid #ddd;">
        <td style="padding: 10px;"><strong>JavaScript</strong></td>
        <td style="padding: 10px;"><pre style="margin:0; font-size: 0.9em;">var token = Math.random(); return token;</pre></td>
        <td style="padding: 10px; text-align: center;"><span class='badge-danger'>PELIGROSO üî¥</span><br><small>94.9% Riesgo</small></td>
        <td style="padding: 10px;">
            <strong>Factores de Riesgo:</strong><br><span class='token-danger'>random (3.55)</span>, <span class='token-danger'>return (0.00)</span><br>
            <hr style="margin: 5px 0; border: 0; border-top: 1px dashed #ccc;">
            <small>Factores de Seguridad: <span class='token-safe'>; (-0.01)</span>, <span class='token-safe'>token (-0.02)</span>, <span class='token-safe'>= (-0.03)</span></small>
        </td>
    </tr>
    
    <tr style="background-color: #e6fffa; border-bottom: 1px solid #ddd;">
        <td style="padding: 10px;"><strong>Python</strong></td>
        <td style="padding: 10px;"><pre style="margin:0; font-size: 0.9em;">def add(a, b):
    result = a + b
    print(f"The result is {result}")
    return result</pre></td>
        <td style="padding: 10px; text-align: center;"><span class='badge-success'>SEGURO üü¢</span><br><small>44.1% Riesgo</small></td>
        <td style="padding: 10px;">
            <strong>Factores de Riesgo:</strong><br><span class='token-danger'>) (0.14)</span>, <span class='token-danger'>f (0.14)</span>, <span class='token-danger'>( (0.02)</span>, <span class='token-danger'>{ (0.00)</span>, <span class='token-danger'>the (0.00)</span><br>
            <hr style="margin: 5px 0; border: 0; border-top: 1px dashed #ccc;">
            <small>Factores de Seguridad: <span class='token-safe'>b (-0.00)</span>, <span class='token-safe'>return (-0.00)</span>, <span class='token-safe'>a (-0.00)</span></small>
        </td>
    </tr>
    
    <tr style="background-color: #ffe6e6; border-bottom: 1px solid #ddd;">
        <td style="padding: 10px;"><strong>Python</strong></td>
        <td style="padding: 10px;"><pre style="margin:0; font-size: 0.9em;">import os
def run_command(user_input):
    # This is a classic command injection vulnerability
    os.system("echo " + user_input)</pre></td>
        <td style="padding: 10px; text-align: center;"><span class='badge-danger'>PELIGROSO üî¥</span><br><small>99.2% Riesgo</small></td>
        <td style="padding: 10px;">
            <strong>Factores de Riesgo:</strong><br><span class='token-danger'>+ (2.91)</span>, <span class='token-danger'>os (1.33)</span>, <span class='token-danger'>) (0.14)</span>, <span class='token-danger'>. (0.05)</span>, <span class='token-danger'>this (0.00)</span><br>
            <hr style="margin: 5px 0; border: 0; border-top: 1px dashed #ccc;">
            <small>Factores de Seguridad: <span class='token-safe'>( (-0.00)</span>, <span class='token-safe'>import (-0.02)</span></small>
        </td>
    </tr>
    
    <tr style="background-color: #ffe6e6; border-bottom: 1px solid #ddd;">
        <td style="padding: 10px;"><strong>Python</strong></td>
        <td style="padding: 10px;"><pre style="margin:0; font-size: 0.9em;">def get_user_by_username(username):
    db = sqlite3.connect(":memory:")
    cursor = db.cursor()

    # La l√≠nea vulnerable. Un atacante podr√≠a pasar: ' OR '1'='1
    query = "SELECT * FROM users WHERE username = '" + username + "'"

    try:
        cursor.execute(query)
        return cursor.fetchall()
    except Exception as e:
        return str(e)</pre></td>
        <td style="padding: 10px; text-align: center;"><span class='badge-danger'>PELIGROSO üî¥</span><br><small>58.5% Riesgo</small></td>
        <td style="padding: 10px;">
            <strong>Factores de Riesgo:</strong><br><span class='token-danger'>query (0.26)</span>, <span class='token-danger'>) (0.25)</span>, <span class='token-danger'>* from (0.06)</span>, <span class='token-danger'>username (0.05)</span>, <span class='token-danger'>( (0.04)</span><br>
            <hr style="margin: 5px 0; border: 0; border-top: 1px dashed #ccc;">
            <small>Factores de Seguridad: <span class='token-safe'>( e (-0.00)</span>, <span class='token-safe'>str (-0.00)</span>, <span class='token-safe'>= 1 (-0.00)</span></small>
        </td>
    </tr>
    
    <tr style="background-color: #e6fffa; border-bottom: 1px solid #ddd;">
        <td style="padding: 10px;"><strong>Python</strong></td>
        <td style="padding: 10px;"><pre style="margin:0; font-size: 0.9em;">def get_user_by_username_safe(username):
    db = sqlite3.connect(":memory:")
    cursor = db.cursor()

    # La forma correcta y segura de hacerlo.
    query = "SELECT * FROM users WHERE username = ?"

    try:
        # La tupla (username,) pasa los datos de forma segura.
        cursor.execute(query, (username,))
        return cursor.fetchall()
    except Exception as e:
        return str(e)</pre></td>
        <td style="padding: 10px; text-align: center;"><span class='badge-success'>SEGURO üü¢</span><br><small>49.4% Riesgo</small></td>
        <td style="padding: 10px;">
            <strong>Factores de Riesgo:</strong><br><span class='token-danger'>query (0.28)</span>, <span class='token-danger'>) (0.24)</span>, <span class='token-danger'>* from (0.06)</span>, <span class='token-danger'>username (0.05)</span>, <span class='token-danger'>from (0.00)</span><br>
            <hr style="margin: 5px 0; border: 0; border-top: 1px dashed #ccc;">
            <small>Factores de Seguridad: <span class='token-safe'>( e (-0.00)</span>, <span class='token-safe'>return (-0.00)</span>, <span class='token-safe'>str (-0.00)</span></small>
        </td>
    </tr>
    
    <tr style="background-color: #e6fffa; border-bottom: 1px solid #ddd;">
        <td style="padding: 10px;"><strong>C++</strong></td>
        <td style="padding: 10px;"><pre style="margin:0; font-size: 0.9em;">#include &lt;iostream&gt;
#include &lt;cstring&gt;
void process_input(char* input) {
    char buffer[16];     
    strcpy(buffer, input);
    std::cout &lt;&lt; "Buffer content: " &lt;&lt; buffer &lt;&lt; std::endl;
}</pre></td>
        <td style="padding: 10px; text-align: center;"><span class='badge-success'>SEGURO üü¢</span><br><small>38.1% Riesgo</small></td>
        <td style="padding: 10px;">
            <strong>Factores de Riesgo:</strong><br><span class='token-danger'>) (0.17)</span>, <span class='token-danger'>); (0.09)</span>, <span class='token-danger'>< (0.08)</span>, <span class='token-danger'>{ (0.04)</span>, <span class='token-danger'>; (0.03)</span><br>
            <hr style="margin: 5px 0; border: 0; border-top: 1px dashed #ccc;">
            <small>Factores de Seguridad: <span class='token-safe'>16 (-0.00)</span>, <span class='token-safe'><< (-0.00)</span>, <span class='token-safe'>; } (-0.00)</span></small>
        </td>
    </tr>
    
        </tbody>
    </table>
</body>
</html>
